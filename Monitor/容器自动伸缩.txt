容器自动伸缩：
弹性伸缩策略：
当监测指标超过所设定的上限，以用户设定的步长增加容器数量
当监测指标超过所设定的下限，以用户设定的步长减少容器数量


服务监测指标：
CPU平均使用量
内存平均使用量
容器的入网速率(目前仅支持通过编排模板进行设置)
容器的出网速率(目前仅支持通过编排模板进行设置)


前提条件
需要将集群的Agent升级到最新版本
需要将监控服务升级到最新版本
开通RAM并在集群中更新访问授权信息()


使用说明
容器服务在判断监测指标是否超出所设定的上下限时，使用的是采集周期(一分钟)内监测指标的(CPU或内存)平均值，而且只有当连续三个采集周期内的监测指标平均值超出所设定的上下限时，容器服务才会触发扩容或伸缩操作，以避免因为监控数据抖动而引起频繁的扩容或缩容操作。

容器缩容的时候，系统会删除集群的容器，所以需要提前做好数据备份。


设置方法
1.使用镜像创建应用
・ 在创建应用时，选择使用镜像创建
・ 在页面最下面调试配置中，勾选开启自动伸缩并设置自动伸缩参数

Note：
1.不要同时设置基于CPU使用量和内存使用量的复合伸缩规则
2.谨慎设置伸缩策略。如果在设置伸缩规则的时候，应用就满足所设置的伸缩条件而且伸缩后应用仍然满足伸缩条件，那么监控将不断地触发伸缩。

2.使用编排模板创建应用
・ 在创建应用时，选择使用编排模板创建
・ 选择使用已有编排模板或者使用自己的编排模板
・ 添加容器的配置信息

3.变更应用配置
1.在应用列表页面，选择需要设置的应用并单击右侧的变更配置
2.在模板 labels配置中，添加容器自动伸缩相应的标签。

在编排模板的labels配置中，添加相应的标签：

指定步长（默认值为 1）：aliyun.auto_scaling.step
最小容器数量（默认值为 1）：aliyun.auto_scaling.min_instances
最大容器数量（默认值为 10）：aliyun.auto_scaling.max_instances
以 CPU 使用量为指标
指定上限： aliyun.auto_scaling.max_cpu
指定下限：aliyun.auto_scaling.min_cpu
以内存使用量为指标
指定上限：aliyun.auto_scaling.max_memory
指定下限：aliyun.auto_scaling.min_memory
以出网速率（bytes/s）为指标
指定上限：aliyun.auto_scaling.max_internetOutRate
指定下限：aliyun.auto.scaling.min_internetOutRate
以入网速率（bytes/s）为指标
指定上限：aliyun.auto_scaling.max_internetInRate
指定下限：aliyun.auto_scaling.min_internetInRate

查看已创建的容器伸缩规则

可以查看已创建的容器伸缩规则
1.登录容器服务管理控制台。
2.单击左侧导航栏中的应用。
3.在应用列表页面，选择所需的应用，单击变量应用配置。



弹性伸缩不起作用怎么办？


1.查看监控指标，确认监控指标有数据并达到阈值一段时间
・ 查看容器弹性伸缩的监控指标(服务-->集群-->监控)，确认监控指标有数据并达到阈值一段时间。
・ 查看节点弹性伸缩的监控指标(集群-->监控)，确认监控指标有数据并达到阈值一段时间。

如果没有监控数据
需要查看监控服务(acsmonitoring)是否正确安装(容器状态及数量是否正确)，查看集群是否为最新版本，监控服务(acsmonitoring)是否为最新版本；如果不是，升级就行

2.查看监控报警规则及状态，确认规则生成且状态正确
・ 在云监控管理控制台，单击左侧导航栏中的云服务监控-->容器服务
・ 单击查看全部规则，可以看到弹性伸缩自动设置的报警规则


如果没有监控报警规则
・ 需要在集群中更新访问授权信息
・ 查看监控服务是否正确安装(容器状态及数量是否正确)，查看集群Agent和服务是否为最新版本；如果不是，请进行升级。


3.查看报警历史
单击报警历史，可以选择时间来查看指定时间段内发生的报警

实例维度CPU使用率
 11:00      0.41%(66)     0.13%(67)
 

服务维度CPU使用率
11:00       0.27%(1)+0.185%+0.605%+0.02%+0.2%+0.695%+0.915%+0.85%


主机监控
11:00     8.11%

